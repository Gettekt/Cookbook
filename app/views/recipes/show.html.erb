<body onload="set_dropdown()">

<%count = 1%>
<%dcount = 1%>
<%tcount =1%>
<%@found = false%>
<p>
	<strong>Author</strong><br>
	<% @recipe.userrecipes.each do |userrecipe| %>
		<%if userrecipe[:contribution_id]%>
      <%@og_user =User.find_by_id(userrecipe[:user_id])%>
			<%=@og_user.username%>
		<%end%>
	<%end%>
</p>
<p>
  <strong>Name</strong><br>
  <%= @recipe.name %>
</p>
<p>
  <strong>Tags</strong><br>
  <% @recipe.tags .each do |tag|%>
    <%=tcount%>.<%=tag.name%>
    <%tcount+=1%>
  <%end%>
</p>

<p>
  <strong>Serves</strong><br>
  <%=@recipe.serves%>
</p>
<p>
  <strong>Rating</strong><br>
  <%=@recipe.rating.round(1)%>
  <%if current_user%>
  <%@user_rating = 0%>
  <%@user = current_user%>
   <%@user.ratings.each do |rating|%>
    <%if rating.recipe_id == @recipe.id%>
      <%@user_rating = rating.value%>
      <%@found = true%>
    <%end%>
  <%end%> 
  <%if @found == false and @first_time_set != nil%>
    <%@user_rating = @first_time_set.to_f%>
  <%end%>
 <%unless current_user == @og_user%>
  <form id="rating_form" action="/update_rating" method="post" onchange="if(this.value != '0') submit()" >
  <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
  <input name="recipe_id" value="<%=@recipe.id%>" type="hidden">
  <select name="rating">
    <option id="0" value=0 selected="selected">Rating</option>
    <option id="1.0" value=1>1</option>
    <option id="2.0" value=2>2</option>
    <option id="3.0" value=3>3</option>
    <option id="4.0" value=4>4</option>
    <option id="5.0" value=5>5</option>
  </select>
  </form>
  <%end%>
  <%end%>
</p>

<p>
  <strong>Ingredients</strong><br>
  <% @recipe.ingredients.each do |ingredient| %><br>
    <%=count%>. <%=ingredient.name%>
    <%count+= 1%>
    <%@recipe.recipeingredients.each do |recipeingredient|%>
      <%if recipeingredient.ingredient_id == ingredient.id%>
        <%=recipeingredient.amount%>
      <%end%>
    <%end%>
  <%end%>
</p>
<p>
  <strong>Directions:</strong><br>
  <% @recipe.directions.split("\n").each do |direction| %>
  	<%=dcount%>. <%=direction%><br>
    <%dcount += 1%>
  <%end%>
</p>
<%unless current_user == @og_user%>
  Favorite
  <form action="/favorite" method="post">
  <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
  <input name="recipe_id" value="<%=@recipe.id%>" type="hidden">
  <%if current_user.favorites.include? @recipe%>
    <input type="hidden" name="state" value="unfavorite">
    <button>&#9733 </button>
  <%else%>
    <input type="hidden" name="state" value="favorite">
    <button>&#9734 </button>
  <%end%>
<%else%>
  <%= link_to 'Edit', edit_recipe_path(@recipe) %> 
<%end%>
</body>



<script>
var rating_form = document.getElementById("rating_form")
var default_select = document.getElementById("0")
var value_to_select =document.getElementById("<%=@user_rating%>")
function set_dropdown(){
 default_select.removeAttribute("selected")
 value_to_select.setAttribute("selected","selected") 
}


</script>
